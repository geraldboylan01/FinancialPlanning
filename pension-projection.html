<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pension Growth Projection</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:'Inter',sans-serif;background:#1a1a1a;color:#fff}
    h1{font-weight:700;margin-top:0;text-align:center}
    .wrapper{min-height:100%;display:flex;justify-content:center;align-items:flex-start;padding:2rem 1rem}
    .card{width:100%;max-width:640px;background:#2a2a2a;border-radius:16px;box-shadow:0 0 25px rgba(0,255,136,.25);padding:2rem}
    .form-group{margin-bottom:1rem}
    label{display:block;margin-bottom:.4rem;font-weight:600}
    input[type=number],input[type=date]{width:100%;padding:.55rem .7rem;border:none;border-radius:8px;background:#404040;color:#fff}
    input::placeholder{color:#aaa}
    .two-col{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
    .radio-group{display:flex;gap:1rem;flex-wrap:wrap}
    button{margin-top:1rem;width:100%;padding:.8rem 1rem;font-weight:700;font-size:1rem;border:none;border-radius:50px;cursor:pointer;color:#1a1a1a;background:linear-gradient(135deg,#00ff88,#0099ff);transition:transform .25s,box-shadow .25s}
    button:hover{transform:scale(1.03);box-shadow:0 0 22px rgba(0,255,136,.8)}
    #results{margin-top:2rem;background:#333;border-radius:12px;padding:1rem 1.2rem}
    #chart-container{margin-top:1.5rem}
    .error{color:#ff5c5c;margin-top:.5rem}
    .max-explanation {
  font-size: 0.9rem;
  color: #ccc;
  margin-top: 0.5rem;
  line-height: 1.4;
}
    .age-table          {width:100%;border-collapse:collapse;margin-top:.8rem}
.age-table th,
.age-table td       {padding:.5rem .6rem;text-align:left}
.age-table thead    {background:#444}
.age-table tbody tr:nth-child(even){background:#3a3a3a}
.age-table th       {font-weight:600}
.salary-cap-note    {font-size:.85rem;color:#bbb;margin-top:.3rem}
.age-table .highlight {
  background-color: #006644 !important;
  font-weight: 600;
}
    /* ─── Modal styles ─────────────────────────────────────── */
.modal {
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;
  z-index:9999;
}
.modal-content {
  background:#2a2a2a;border-radius:16px;padding:2rem 2.5rem;max-width:420px;width:90%;
  text-align:center;box-shadow:0 0 25px rgba(255,0,0,.4);position:relative;
}
.close-btn {
  position:absolute;right:1.2rem;top:0.8rem;font-size:1.8rem;cursor:pointer;color:#fff;
}
.modal h2 {margin-top:0;color:#ff5c5c}



  </style>
</head>
<body>
  <div class="wrapper">
    <div class="card">
      <h1>Pension Projection Tool</h1>

      <form id="proj-form" autocomplete="off">
        <div class="form-group">
          <label for="salary">Gross salary (€) <small>(max €115 000 is used in calculations)</small></label>
          <input type="number" id="salary" required />
        </div>

        <div class="form-group">
          <label for="currentValue">Current pension value (€)</label>
          <input type="number" id="currentValue" required />
        </div>

        <div class="two-col">
          <div class="form-group">
            <label for="personalContrib">Your annual contribution (€)</label>
            <input type="number" id="personalContrib" placeholder="Leave blank if % instead" />
          </div>
          <div class="form-group">
            <label for="personalPct">% of salary</label>
            <input type="number" id="personalPct" step="0.1" placeholder="Leave blank if € used" />
          </div>
        </div>

        <div class="two-col">
          <div class="form-group">
            <label for="employerContrib">Employer annual contribution (€)</label>
            <input type="number" id="employerContrib" placeholder="Leave blank if % instead" />
          </div>
          <div class="form-group">
            <label for="employerPct">% of salary</label>
            <input type="number" id="employerPct" step="0.1" placeholder="Leave blank if € used" />
          </div>
        </div>

        <div class="form-group">
          <label for="dob">Your date of birth</label>
          <input type="date" id="dob" required />
        </div>

        <div class="form-group">
          <label for="retireAge">Desired retirement age</label>
          <input type="number" id="retireAge" min="50" max="70" value="65" required />
        </div>

        <div class="form-group">
          <label>Growth profile</label>
          <div class="radio-group">
            <label><input type="radio" name="growth" value="0.04"> Low&nbsp;Risk&nbsp;(4%)</label>
            <label><input type="radio" name="growth" value="0.05" checked> Medium&nbsp;Risk&nbsp;(5%)</label>
            <label><input type="radio" name="growth" value="0.06"> High&nbsp;Risk&nbsp;(6%)</label>
            <label><input type="radio" name="growth" value="0.07"> 100%&nbsp;Equity&nbsp;Risk&nbsp;(7%)</label>
          </div>
        </div>

        <button type="submit">Project value</button>
      </form>

      <div id="results"></div>
      <div id="chart-container"><canvas id="growthChart"></canvas></div>
      <div id="console" class="error"></div>
    </div>
  </div>
<!-- This is the modal box that appears if the pension exceeds the SFT -->
<div id="sftModal" class="modal" style="display:none">
  <div class="modal-content">
    <span id="sftClose" class="close-btn">&times;</span>
    <h2>⚠️ Warning</h2>
    <p id="sftMessage"></p>
    <p style="margin-top:1rem;font-size:0.9rem;color:#ccc">
      Amounts above the Standard Fund Threshold<br>
      (€2 million in 2025, increasing €200k/year to €2.8 million in 2029)<br>
      are liable to a 40% <u>Chargeable Excess Tax</u>.<br><br>
      Please seek professional financial advice.
    </p>
  </div>
</div>
  
<script>
const MAX_SALARY_CAP = 115000;
const AGE_BANDS = [
  { max: 29,  pct: 0.15 },
  { max: 39,  pct: 0.20 },
  { max: 49,  pct: 0.25 },
  { max: 54,  pct: 0.30 },
  { max: 59,  pct: 0.35 },
  { max: 120, pct: 0.40 }
];

  // ─── Standard Fund Threshold schedule ──────────────────────────
function sftForYear(year) {
  if (year < 2026) return 2000000;
  if (year <= 2029) return 2000000 + 200000 * (year - 2025);
  return 2800000;
}

let growthChart = null;
let balances = [],       // base scenario data
    currentPv,           // starting value
    curAge,              // current age
    yearsToRet,
    salaryCapped,
    personalUsed,
    employerCalc,
    gRate,
    retireAge;

// Helpers
function ageInYears(date, ref) {
  return (ref - date) / (1000*60*60*24*365.25);
}
function maxPersonalPct(age) {
  return AGE_BANDS.find(b => age <= b.max).pct;
}
function maxPersonalByAge(age, capSalary) {
  return maxPersonalPct(Math.floor(age)) * capSalary;
}

// Injects the checkbox under the chart once
function ensureMaxToggleExists() {
  if (document.getElementById('maxToggle')) return;
  const div = document.createElement('div');
  div.className = 'form-group';
  div.style.marginTop = '1rem';
  div.innerHTML = `
    <label>
      <input type="checkbox" id="maxToggle">
      Show max-contribution scenario
    </label>
  `;
  document.querySelector('#chart-container')
          .insertAdjacentElement('afterend', div);
  document.getElementById('maxToggle')
          .addEventListener('change', drawChart);
}
  function showSFTWarning(projectedValue, sftLimit, year) {
  const modal   = document.getElementById('sftModal');
  const message = document.getElementById('sftMessage');
  message.innerHTML = `
    Your projected pension value is <strong>€${projectedValue.toLocaleString()}</strong>,
    which exceeds the Standard Fund Threshold for ${year} (<strong>€${sftLimit.toLocaleString()}</strong>).
  `;
  modal.style.display = 'flex';
}

// Close handlers (runs once)
document.getElementById('sftClose').onclick = () =>
  document.getElementById('sftModal').style.display = 'none';

window.onclick = e => {
  if (e.target.id === 'sftModal')
    document.getElementById('sftModal').style.display = 'none';
};
  window.addEventListener('keydown', e => {
  if (e.key === 'Escape') {
    document.getElementById('sftModal').style.display = 'none';
  }
});



// Draws the chart (base + optional max line) and appends explanatory note
function drawChart() {
  const showMax = document.getElementById('maxToggle')?.checked;
  const datasets = [{
    label: 'Your Projection',
    data: balances.map(b => b.value),
    borderColor: '#00ff88',
    backgroundColor: 'rgba(0,255,136,0.15)',
    fill: true,
    tension: 0.25
  }];

  let extraHTML = '';
  if (showMax) {
    const maxBalances = [];
    let maxBal = currentPv;
    for (let y = 1; y <= yearsToRet; y++) {
      const ageNext = curAge + y;
      const personalMax = maxPersonalByAge(ageNext, salaryCapped);
      maxBal = maxBal * (1 + gRate) + personalMax + employerCalc;
      maxBalances.push({ age: Math.floor(ageNext), value: Math.round(maxBal) });
    }

    datasets.push({
      label: 'Max Contribution',
      data: maxBalances.map(b => b.value),
      borderColor: '#0099ff',
      borderDash: [6,4],
      fill: false,
      tension: 0.25
    });

    // Build dynamic table rows using the capped salary
// Build dynamic table rows using the capped salary and user's age band
const bandLabels = [
  'Up&nbsp;to&nbsp;29',
  '30&nbsp;–&nbsp;39',
  '40&nbsp;–&nbsp;49',
  '50&nbsp;–&nbsp;54',
  '55&nbsp;–&nbsp;59',
  '60&nbsp;+'
];

// Find the user's age band index
const currentAge = Math.floor(curAge);
const bandIndex = AGE_BANDS.findIndex(b => currentAge <= b.max);

// Build the table rows, highlighting the current band
const rowsHtml = AGE_BANDS.map((band, i) => `
  <tr class="${i === bandIndex ? 'highlight' : ''}">
    <td>${bandLabels[i]}</td>
    <td>${(band.pct * 100).toFixed(0)} %</td>
    <td>€${(band.pct * salaryCapped).toLocaleString()}</td>
  </tr>`
).join('');

extraHTML = `
  <p class="max-note">
    <em>Max-contribution value at ${retireAge}:
    <strong>€${maxBalances.at(-1).value.toLocaleString()}</strong></em>
  </p>

  <table class="age-table">
    <thead>
      <tr>
        <th>Age&nbsp;band</th>
        <th>Max&nbsp;%</th>
        <th>Max&nbsp;€ (on&nbsp;€${salaryCapped.toLocaleString()})</th>
      </tr>
    </thead>
    <tbody>
      ${rowsHtml}
    </tbody>
  </table>

  <p class="salary-cap-note">
    <strong>Note:</strong> Your current age (${currentAge}) falls in the highlighted band above. This determines your personal pension contribution limit for this year.
    <br>*Personal limits are calculated on a maximum reckonable salary of €115,000.
    Employer contributions are <strong>not</strong> subject to this cap.
  </p>
`;

  }

  if (growthChart) growthChart.destroy();
  growthChart = new Chart(document.getElementById('growthChart'), {
    type: 'line',
    data: {
      labels: balances.map(b => `Age ${b.age}`),
      datasets
    },
    options: {
      responsive: true,
      plugins: { legend: { position: 'top' } },
      scales: {
        y: { ticks: { callback: v => '€' + v.toLocaleString() } }
      }
    }
  });

  // update results div
  const results = document.getElementById('results');
  results.querySelectorAll(
  '.max-note, .max-explanation, .age-table, .salary-cap-note')
  .forEach(el => el.remove());

  if (extraHTML) {
    const wrapper = document.createElement('div');
    wrapper.innerHTML = extraHTML;
    results.append(wrapper);
  }
}

// Form handler
document.getElementById('proj-form').addEventListener('submit', e => {
  e.preventDefault();
  try {
    // Inputs
    const salaryRaw  = +document.getElementById('salary').value;
    salaryCapped    = Math.min(salaryRaw, MAX_SALARY_CAP);
    currentPv       = +document.getElementById('currentValue').value;
    const personalRaw = +document.getElementById('personalContrib').value || 0;
const personalPct = (+document.getElementById('personalPct').value || 0) / 100;

const employerRaw = +document.getElementById('employerContrib').value || 0;
const employerPct = (+document.getElementById('employerPct').value || 0) / 100;
employerCalc      = employerRaw > 0 ? employerRaw : salaryRaw * employerPct;

    retireAge       = +document.getElementById('retireAge').value;
    gRate           = +document.querySelector('input[name="growth"]:checked').value;
    const dob       = new Date(document.getElementById('dob').value);

    if (!salaryRaw || !currentPv || isNaN(dob)) {
      throw 'Please fill salary, DOB and current value';
    }

    // Personal contributions capped by age band
    curAge  = ageInYears(dob, new Date());
    const personalCalc = personalRaw > 0
      ? personalRaw
      : salaryCapped * personalPct;
    const limitValue   = maxPersonalPct(Math.floor(curAge)) * salaryCapped;
    personalUsed       = Math.min(personalCalc, limitValue);

    // Build balances
    yearsToRet = Math.max(0, retireAge - curAge);
    balances   = [];
    let bal    = currentPv;
    for (let y = 1; y <= yearsToRet; y++) {
      bal = bal * (1 + gRate) + personalUsed + employerCalc;
      balances.push({ age: Math.floor(curAge) + y, value: Math.round(bal) });
    }

    // Show base results
    const projValue      = balances.at(-1).value;
const retirementYear = new Date().getFullYear() + Math.ceil(yearsToRet);
const sftLimit       = sftForYear(retirementYear);

document.getElementById('results').innerHTML = `
  <p>
    Max personal contribution allowed (age ${Math.floor(curAge)}):
    <strong>€${limitValue.toLocaleString()}</strong>
  </p>
  <p>
    Using <strong>€${personalUsed.toLocaleString()}</strong> personal +
    <strong>€${employerCalc.toLocaleString()}</strong> employer each year.
  </p>
  <h2>
    Projected value at age ${retireAge}:<br>
    <strong>€${projValue.toLocaleString()}</strong>
  </h2>
`;

if (projValue > sftLimit) {
  showSFTWarning(projValue, sftLimit, retirementYear);
}

    

    // Inject toggle and draw
    ensureMaxToggleExists();
    drawChart();

    document.getElementById('console').textContent = '';
  } catch (err) {
    document.getElementById('console').textContent = err;
    if (growthChart) growthChart.destroy();
  }
});
</script>


</body>
</html>

