<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=yes" />
  <title>Planéir – Full Monty</title>
  <link rel="icon" type="image/png" href="favicon.png" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles/inputs.css">
  <style>
    :root{
      --accent:#c000ff;
      --glow:#00ff88;
      --danger:#ff5c5c;
      --surface-2:#353535;
      --surface-3:#404040;
      --surface-4:rgba(255,255,255,.08);
      --text-1:#fff;
      --text-2:#aaa;
      --shadow-sm:0 2px 4px rgba(0,0,0,.2);
    }
    *{box-sizing:border-box}
    body{font-family:'Inter',sans-serif;background:#1a1a1a;color:#fff;display:flex;justify-content:center;align-items:center;min-height:100vh;padding:1rem;margin:0;}
    body.modal-open{overflow:hidden;}
    button{padding:.5rem .9rem;font-weight:700;font-size:1rem;border:none;border-radius:8px;cursor:pointer;color:#fff;background:#555;margin:.3rem 0;min-height:2.5rem;}
    .fm-wizard.modal{display:none;}
    .fm-wizard.modal.is-open{position:fixed;inset:0;z-index:1000;background:rgba(0,0,0,.5);display:flex;align-items:stretch;justify-content:center;}
    .fm-sheet{position:relative;width:100%;max-width:720px;margin:0 auto;height:100vh;height:100svh;display:flex;flex-direction:column;background:var(--surface,#1b1b1b);}
    @supports (height: 100dvh){.fm-sheet{height:100dvh;}}
    .fm-sheet,.fm-header,.fm-footer{padding-left:max(16px,env(safe-area-inset-left));padding-right:max(16px,env(safe-area-inset-right));}
    .fm-header{padding-top:max(12px,env(safe-area-inset-top));}
    .fm-footer{padding-bottom:max(12px,env(safe-area-inset-bottom));}
    .fm-header{position:sticky;top:0;z-index:2;background:var(--surface,#1b1b1b);border-bottom:1px solid rgba(255,255,255,.06);}
    .fm-footer{position:sticky;bottom:0;z-index:2;background:var(--surface,#1b1b1b);border-top:1px solid rgba(255,255,255,.06);display:flex;gap:.75rem;justify-content:space-between;box-shadow:none;}
    .fm-body{position:relative;height:calc(100% - var(--fm-header-h,0px) - var(--fm-footer-h,0px));overflow-y:auto;-webkit-overflow-scrolling:touch;overscroll-behavior:contain;scroll-padding-top:calc(var(--fm-header-h,0px) + 12px);padding-top:12px;padding-bottom:12px;}
    .input-wrap{min-height:48px;}
    .fm-body .form-row{margin:14px 0;}
    input,select,textarea{font-size:16px;}
    .wizard-footer,.wizard-actions,.modal-footer,.footer-wrap,.modal .actions,.modal .footer{background:transparent;box-shadow:none;border:0;}
    .fm-section{scroll-margin-top:calc(var(--fm-header-h,0px) + 12px);}
    #fmProgress{margin:0 0 .8rem 0;font-weight:600;font-size:1.1rem;text-align:center;color:#fff;}
    #fmProgressBar{height:6px;background:#ddd;border-radius:3px;margin:0 24px 12px;}
    #fmProgressFill{height:100%;width:0;background:var(--accent);border-radius:3px;transition:width .25s ease;}
    #fmDots{display:flex;justify-content:center;gap:8px;}
    #fmTitle{margin:.25rem 0 0;font-weight:800;font-size:1.05rem;color:#fff;text-align:center;}
    .btn-list-add{display:flex;justify-content:center;align-items:center;width:100%;background:#555;color:#fff;font-weight:700;border-radius:12px;padding:.9rem 1rem;cursor:pointer;border:none;transition:transform .2s,box-shadow .2s,filter .2s;}
    .btn-list-add:hover, .btn-list-add:focus-visible{transform:translateY(-1px);box-shadow:0 0 16px rgba(255,255,255,.08);outline:2px solid transparent;}
    .form{display:flex;flex-direction:column;gap:1rem;}
    .form-group{margin-bottom:1rem;}
    .form-2col{display:grid;grid-template-columns:1fr 1fr;gap:1rem;}
    @media(max-width:480px){.form-2col{grid-template-columns:1fr;}}
    .form-group.control{display:flex;align-items:center;gap:.5rem;margin-bottom:1rem;}
    label{display:block;margin-bottom:.4rem;font-weight:600;}
    .form-group.control label{margin:0;font-weight:400;}
    input[type=date],input[type=number],input[type=text],select{width:100%;padding:.55rem .7rem;border:1px solid transparent;border-radius:8px;background:#404040;color:#fff;}
    input::placeholder{color:#aaa;}
    input:focus,select:focus{outline:none;border-color:var(--glow);box-shadow:0 0 0 3px rgba(0,255,136,.25);}
    .error{color:var(--error, #ff6b6b);margin-top:.5rem;font-size:.9rem;}

    /* Pension risk cards */
    .risk-grid{
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:1rem;
      margin-top:1rem;
    }
    @media (max-width:640px){
      .risk-grid{grid-template-columns:1fr;}
    }
    .risk-card{
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      gap:.25rem;
      padding:1rem;
      border:1px solid var(--field-border,rgba(255,255,255,.12));
      border-radius:12px;
      background:var(--field-bg,rgba(255,255,255,.04));
      outline:none;
      cursor:pointer;
      transition:transform .08s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .risk-card:hover{transform:translateY(-1px);}
    .risk-card:focus{box-shadow:var(--focus-ring,0 0 0 3px rgba(0,255,136,.25));}
    .risk-card.selected{
      border-color:var(--focus,#00ff88);
      box-shadow:var(--focus-ring,0 0 0 3px rgba(0,255,136,.25));
    }
    .risk-title{font-weight:700;}
    .risk-mix{font-size:.9rem;opacity:.9;}
    .risk-rate{font-size:.85rem;opacity:.8;}

    /* Optional: row grouping look */
    .list-wrap .asset-row{
      background:#353535; border:1px solid rgba(255,255,255,.08);
      border-radius:12px; padding:.8rem; margin-bottom:.8rem;
    }

      .subsection{ margin-top:1.25rem; }
      .stack{ display:grid; gap:1rem; }
      .btn-secondary{
        display:block;
        width:100%;
        padding:.8rem 1rem;
        border-radius:1rem;
        background:var(--surface-3);
        border:1px solid var(--surface-4);
        color:var(--text-2);
        cursor:pointer;
      }
      .btn-secondary[disabled]{ opacity:.5; cursor:not-allowed; }

      /* Optional: make the home row look like a soft card */
      .card-like{
        background:#353535;
        border:1px solid rgba(255,255,255,.08);
        border-radius:12px;
        padding: .9rem;
      }
      .card-like .form-group + .form-group{ margin-top: .8rem; }

    /* Slightly tighter spacing for the conditional rent input */
    .form-group.condensed label{ margin-bottom: .25rem; }

    /* Pill toggles */
    .pill-row{display:flex;flex-wrap:wrap;gap:.6rem;margin:.2rem 0 0}
    .pill-toggle{
      appearance:none;border:1px solid var(--surface-4);background:var(--surface-3);
      color:var(--text-2);padding:.55rem .8rem;border-radius:999px;display:inline-flex;
      align-items:center;gap:.5rem;cursor:pointer;transition:.15s transform,.2s box-shadow,.2s border-color;
    }
    .pill-toggle .dot{width:.6rem;height:.6rem;border-radius:50%;background:#666}
    .pill-toggle.is-on{border-color:rgba(0,255,136,.35);background:rgba(0,255,136,.12);color:#00ff88}
    .pill-toggle.is-on .dot{background:#00ff88}
    .pill-toggle:active{transform:translateY(1px)}

    /* Income cards */
    .income-card{
      background:#2b2b2b;border:1px solid rgba(255,255,255,.08);
      border-radius:14px;overflow:hidden;margin-top:.75rem
    }
    .ic-head{display:flex;align-items:center;justify-content:space-between;padding:.75rem 1rem;background:#262626}
    .ic-title{font-weight:800}
    .ic-actions .ic-toggle{
      background:transparent;border:1px solid rgba(255,255,255,.14);
      color:#ddd;border-radius:999px;padding:.35rem .7rem;cursor:pointer
    }
    .ic-body{
      display:grid;gap:.8rem;padding:1rem;max-height:0;opacity:0;
      transition:max-height .25s ease, opacity .2s ease
    }
    .income-card.open .ic-body{max-height:600px;opacity:1}

    /* Inputs inside cards align nicely */
    .income-card .form-group label{margin-bottom:.35rem}

    /* Keep it comfy on small screens */
    @media (max-width: 480px){
      .pill-row{gap:.45rem}
      .ic-body{padding:.8rem}
    }

    @media (max-width: 768px) {
      .fm-range { display:none; }
      .fm-stepper { display:inline-flex; align-items:center; gap:.5rem; background:var(--field-bg, #404040); color:var(--field-ink, #fff); border-radius:10px; padding:.5rem .5rem; }
      .fm-stepper button { min-width:2.5rem; min-height:2.5rem; border:0; border-radius:8px; background:rgba(255,255,255,.08); }
      .fm-stepper-input { width:8ch; text-align:center; background:transparent; border:0; color:inherit; }
    }

    @keyframes slideInLeft{from{transform:translateX(-40px);opacity:0}to{transform:none;opacity:1}}
    @keyframes slideInRight{from{transform:translateX(40px);opacity:0}to{transform:none;opacity:1}}
    #fmStepContainer.anim-left{animation:slideInLeft .25s ease-out both}
    #fmStepContainer.anim-right{animation:slideInRight .25s ease-out both}
    /* Results wrapper */
    .fm-results{
      display:flex;
      justify-content:center;
      padding:2rem 1rem 4rem;
    }
    .results-shell{
      width: clamp(1024px, 95vw, 1800px);
      margin: 0 auto;
    }

    /* KPI cards: stick to 3 across on desktop */
    .kpi-row{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 16px;
      margin: 12px 0 20px;
    }
    .kpi-card{background:#2b2b2b;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px}
    .kpi-card.ok{outline:1px solid rgba(0,255,136,.35);box-shadow:0 0 0 3px rgba(0,255,136,.15) inset}
    .kpi-card.warn{outline:1px solid rgba(255,180,0,.35);box-shadow:0 0 0 3px rgba(255,180,0,.08) inset}
    .kpi-card.danger{outline:1px solid rgba(255,77,77,.35);box-shadow:0 0 0 3px rgba(255,77,77,.08) inset}
    .kpi-label{font-size:.9rem;color:#aaa;margin-bottom:4px}
    .kpi-val{font-size:1.25rem;font-weight:800}

    /* Charts: exactly 2 columns on desktop, stack below 1100px */
    .chart-grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(540px, 1fr));
      gap: 16px;
      margin-top: 12px;
    }
    .chart-wrapper{
      height: clamp(360px, 46vh, 560px);
      background:#232323;
      border:1px solid rgba(255,255,255,.08);
      border-radius:12px;
      padding:8px;
    }
    @media (max-width: 1100px){
      .chart-grid{ grid-template-columns: 1fr; }
    }
    @media (max-width: 900px){
      .kpi-row{ grid-template-columns: 1fr; }
    }

    /* Summary strip */
    .summary-row{
      margin: 6px 0 10px;
      padding: 12px 14px;
      border-radius: 12px;
      background: #232323;
      border: 1px solid rgba(255,255,255,.08);
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 12px;
      align-items: center;
    }
    .summary-row .headline{
      font-weight: 800;
      font-size: 1.05rem;
    }
    .summary-row.ok{ box-shadow: 0 0 0 3px rgba(0,255,136,.12) inset; }
    .summary-row.warn{ box-shadow: 0 0 0 3px rgba(255,180,0,.12) inset; }
    .summary-row.danger{ box-shadow: 0 0 0 3px rgba(255,77,77,.12) inset; }
    .summary-row .actions{ display:flex; gap:.5rem; }
    .summary-row .action-btn{
      background:#2f2f2f;border:1px solid rgba(255,255,255,.14);
      color:#ddd;border-radius:999px;padding:.45rem .8rem; font-weight:700;
    }

    /* Toggle and table styles */
    .results-controls{
      display:flex; align-items:center; gap:16px; margin: 10px 0 6px;
      flex-wrap: wrap;
    }
    .btn-secondary.small{ padding:.5rem .8rem; font-size:.95rem; }

    /* Floating "Edit inputs" FAB on desktop */
    .fab-edit{
      /* base look (used on mobile too) */
      background: var(--glow, #00ff88);
      color: #0b1f16;           /* readable on neon green */
      border: 1px solid rgba(0,255,136,.25);
      border-radius: 999px;
      font-weight: 800;
      padding: .7rem 1rem;
      box-shadow: 0 8px 24px rgba(0,255,136,.18), 0 0 0 2px rgba(0,255,136,.08) inset;
      transition: transform .15s ease, box-shadow .2s ease, filter .2s ease;
    }

    /* Desktop >= 980px: float to bottom-right and enlarge a bit */
    @media (min-width: 980px){
      .fab-edit{
        position: fixed;
        right: 28px;
        bottom: 28px;
        z-index: 50;          /* above charts */
        padding: .9rem 1.25rem;
        font-size: 1rem;
      }
    }

    /* Hover/active feedback */
    .fab-edit:hover{ 
      transform: translateY(-1px);
      box-shadow: 0 12px 28px rgba(0,255,136,.22), 0 0 0 2px rgba(0,255,136,.18) inset;
      filter: saturate(1.05);
    }
    .fab-edit:active{
      transform: translateY(0);
      box-shadow: 0 6px 16px rgba(0,255,136,.18), 0 0 0 2px rgba(0,255,136,.18) inset;
    }

    /* Keep the inline toolbar layout clean on mobile */
    @media (max-width: 979px){
      .results-controls{
        gap: 12px;
      }
      .fab-edit.small{
        /* compact pill on mobile within the row */
        position: static;
        margin-left: auto;     /* pushes to the right end of the row */
      }
    }

    /* Optional: tidy the toolbar spacing on desktop */
    @media (min-width: 980px){
      .results-controls{
        margin: 10px 0 4px;    /* slimmer row since the FAB is floating */
      }
    }

    .toggle{
      --h: 44px; --pad: 4px; --knob: 32px;
      position: relative; display:inline-block; height: var(--h);
    }
    .toggle input{ position:absolute; opacity:0; pointer-events:none; }
    .toggle .track{
      display:flex; align-items:center; position:relative;
      padding: 0 calc(var(--pad) + var(--knob) + 8px) 0 var(--pad);
      height: var(--h); min-width: 340px;
      background:#212121; border:1px solid rgba(0,255,136,.25);
      border-radius:999px; box-shadow: 0 0 0 2px rgba(0,255,136,.1) inset;
      color:#ddd; font-weight:700;
    }
    .toggle .label{ margin:0 auto; }
    .toggle .knob{
      position:absolute; top:50%; left:var(--pad);
      width:var(--knob); height:var(--knob);
      border-radius:50%; transform:translateY(-50%);
      background:#555; box-shadow: inset 0 0 0 1px rgba(255,255,255,.2);
      transition: left .22s ease, background .22s ease, box-shadow .22s ease;
    }
    .toggle input:checked + .track .knob{
      left: calc(100% - var(--pad) - var(--knob));
      background:#00ff88; box-shadow: 0 0 0 6px rgba(0,255,136,.12);
    }
    .toggle input:checked + .track{
      outline:1px solid rgba(0,255,136,.35);
    }

    .toggle-note{
      color:#a6ffd8; font-weight:700;
    }

    .max-table-section{
      margin-top: 16px;
      background:#222; border:1px solid rgba(255,255,255,.08);
      border-radius:12px; padding:14px;
    }
    .max-table-section h3{
      margin: 0 0 6px; color:#a6ffd8;
    }
    .max-table{
      width:100%; border-collapse:separate; border-spacing:0;
      overflow:hidden; border-radius:10px; border:1px solid rgba(255,255,255,.08);
    }
    .max-table th, .max-table td{
      padding:12px 14px; text-align:left;
    }
    .max-table thead th{
      background:#2d2d2d; color:#ddd;
    }
    .max-table tbody tr:nth-child(even){ background:#262626; }
    .max-table tbody tr:nth-child(odd){ background:#2a2a2a; }
    .max-table tr.highlight{ background:#095b45 !important; color:#fff; }
    .max-note{ margin-top:8px; color:#bbb; }

    /* ===== Chart helper UI (headline + info tooltip) ===== */
    .chart-wrapper {
      position: relative;
      margin-bottom: 2rem;
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: .5rem;
    }

    .chart-headline {
      font-size: 1.1rem;
      font-weight: 600;
      margin: 0;
      color: #fff;
    }

    .info-icon {
      background: #333;
      color: #fff;
      border-radius: 50%;
      width: 22px;
      height: 22px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: .9rem;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease, transform 0.1s ease;
      user-select: none;
    }
    .info-icon:hover,
    .info-icon:focus {
      background: #00ff88; /* neon highlight */
      color: #000;
      outline: none;
      transform: translateY(-1px);
    }

    .tooltip-box {
      position: absolute;
      top: 40px;
      right: 0;
      background: #232323;
      color: #fff;
      font-size: 0.9rem;
      line-height: 1.5;
      padding: 1rem;
      border-radius: 12px;
      box-shadow: 0 10px 24px rgba(0,0,0,.35);
      max-width: 320px;
      display: none;
      z-index: 100;
      animation: fadeSlideIn 0.18s ease-in-out;
    }

    .tooltip-box p {
      margin: 0 0 .8rem 0;
    }
    .tooltip-box p:last-child { margin-bottom: 0; }

    @keyframes fadeSlideIn {
      from { opacity: 0; transform: translateY(6px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* Mobile adjustments */
    @media (max-width: 600px) {
      .tooltip-box {
        max-width: 90vw;
        right: 5%;
      }
    }

    /* Short, friendly captions under charts (optional hooks) */
    /* (deprecated: captions replaced by info tooltips) */
  </style>
</head>
<body>
  <div id="fullMontyModal" class="fm-wizard modal" role="dialog" aria-modal="true">
    <div class="fm-sheet">
      <header class="fm-header">
        <div class="fm-step-title" id="fmProgress"></div>
        <div class="fm-progress">
          <div id="fmProgressBar"><div id="fmProgressFill"></div></div>
          <div id="fmDots"></div>
        </div>
        <h2 class="fm-page-title" id="fmTitle"></h2>
      </header>

      <main class="fm-body" id="fmBody" tabindex="-1">
        <div id="fmStepContainer"></div>
      </main>

      <footer class="fm-footer">
        <button class="btn-secondary fm-back" id="fmBack">Back</button>
        <button class="btn-primary fm-next" id="fmNext">Next</button>
      </footer>
    </div>
  </div>
  <section id="fullMontyResults" class="fm-results">
    <div class="results-shell">
      <!-- Top Summary / Actions row -->
      <div id="resultsSummary" class="summary-row" aria-live="polite"></div>

      <div id="kpis" class="kpi-row"></div>

      <div class="results-controls">
        <label class="toggle max-toggle" id="maxContribsToggle">
          <input type="checkbox" id="maxContribsChk" />
          <span class="track">
            <span class="label">Use max pension contributions</span>
            <span class="knob"></span>
          </span>
        </label>
        <div id="maxToggleNote" class="toggle-note" aria-live="polite"></div>
        <button id="editInputsBtn" class="btn-primary small fab-edit" aria-label="Edit inputs">
          Edit inputs
        </button>
      </div>

      <div class="chart-grid">
        <div class="chart-wrapper" id="chart-pension-value">
          <div class="chart-header">
            <h3 class="chart-headline">Will my pension reach my Financial Freedom Target?</h3>
            <span class="info-icon" tabindex="0" aria-label="Chart information">i</span>
          </div>
          <canvas id="growthChart"></canvas>
          <div class="tooltip-box" role="tooltip">
            <p class="tooltip-text pv-default">
              This line shows how your pension could grow over time if you keep contributing as you are.
            </p>
            <p class="tooltip-text pv-max" style="display:none;">
              This line shows how your pension could grow over time if you make the maximum allowable pension contributions based on your salary.
            </p>
            <p class="tooltip-text">
              The purple dotted line is your <strong>Financial Freedom Target</strong> — the amount needed to support your estimated income requirement in retirement all the way to age 100.
            </p>
            <p class="tooltip-text">
              The red line is the government’s pension cap (<strong>Standard Fund Threshold</strong>).
            </p>
            <p class="tooltip-text">
              If your curve rises above the purple line, you’re on track for financial freedom. If it rises above the red line, you may face extra tax rules.
            </p>
            <div class="conditional-slot"></div>
          </div>
        </div>

        <div class="chart-wrapper" id="chart-annual-contrib">
          <div class="chart-header">
            <h3 class="chart-headline">How much comes from me vs. my money working for me?</h3>
            <span class="info-icon" tabindex="0" aria-label="Chart information">i</span>
          </div>
          <canvas id="contribChart"></canvas>
          <div class="tooltip-box" role="tooltip">
            <p class="tooltip-text ac-default">
              The green bars are the contributions you make each year. The orange bars show how your money grows once invested.
            </p>
            <p class="tooltip-text ac-max" style="display:none;">
              The blue bars are the maximum pension contributions you could make each year. The orange bars show how your money grows once invested.
            </p>
            <p class="tooltip-text">
              This highlights the power of compounding — your money earning money — which becomes a major driver of your pension’s long-term growth.
            </p>
          </div>
        </div>

        <div class="chart-wrapper" id="chart-retirement-balance">
          <div class="chart-header">
            <h3 class="chart-headline">Will my pension last to age 100?</h3>
            <span class="info-icon" tabindex="0" aria-label="Chart information">i</span>
          </div>
          <canvas id="ddBalanceChart"></canvas>
          <div class="tooltip-box" role="tooltip">
            <p class="tooltip-text">
              This chart shows your projected pension balance throughout retirement.
            </p>
            <p class="tooltip-text">
              The purple dotted line starts at your <strong>Financial Freedom Target</strong> — the amount needed to meet your estimated income requirement until age 100 — and shows how that target would gradually deplete over time.
            </p>
            <p class="tooltip-text rb-default">
              The green curve shows how your pension could perform at retirement if you keep contributing as you are, and how long it might last.
            </p>
            <p class="tooltip-text rb-max" style="display:none;">
              The blue curve shows how your pension could perform at retirement if you make the maximum allowable contributions, and how long it might last.
            </p>
            <div class="conditional-slot"></div>
          </div>
        </div>

        <div class="chart-wrapper" id="chart-retirement-income">
          <div class="chart-header">
            <h3 class="chart-headline">Will my income cover my lifestyle in retirement?</h3>
            <span class="info-icon" tabindex="0" aria-label="Chart information">i</span>
          </div>
          <canvas id="ddCashflowChart"></canvas>
          <div class="tooltip-box" role="tooltip">
            <p class="tooltip-text">
              This chart shows the income you could draw from your pension each year, along with any other retirement income sources (such as State Pension or rental income).
            </p>
            <p class="tooltip-text">
              The line above represents your estimated income requirement in retirement, which gradually rises due to inflation.
            </p>
            <p class="tooltip-text">
              The aim is for your combined income sources to meet or exceed this requirement each year.
            </p>
          </div>
        </div>
      </div>

      <!-- Max table section (bottom of page) -->
      <section id="maxTableSection" class="max-table-section" aria-live="polite">
        <!-- JS will inject a heading + table OR a helpful message -->
      </section>
    </div>

  </section>

  <script src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.js"></script>
  <script>
    (function initChartInfoUI(){
      const wrappers = document.querySelectorAll('.chart-wrapper');

      wrappers.forEach(wrapper => {
        const icon = wrapper.querySelector('.info-icon');
        const tooltip = wrapper.querySelector('.tooltip-box');
        if (!icon || !tooltip) return;

        // Hover (desktop)
        icon.addEventListener('mouseenter', () => { tooltip.style.display = 'block'; });
        icon.addEventListener('mouseleave', () => { tooltip.style.display = 'none'; });

        // Click/tap toggle (mobile + accessibility)
        icon.addEventListener('click', (e) => {
          e.stopPropagation();
          tooltip.style.display = (tooltip.style.display === 'block') ? 'none' : 'block';
        });

        // Close when clicking outside
        document.addEventListener('click', (e) => {
          if (!wrapper.contains(e.target)) tooltip.style.display = 'none';
        });

        // Keyboard access
        icon.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            tooltip.style.display = (tooltip.style.display === 'block') ? 'none' : 'block';
          }
          if (e.key === 'Escape') {
            tooltip.style.display = 'none';
            icon.blur();
          }
        });
      });

      // Toggle-aware text visibility helper
      function toggleTextFor(selectorPairs, isMaxOn){
        selectorPairs.forEach(({defaultSel, maxSel}) => {
          const defaultEl = document.querySelector(defaultSel);
          const maxEl = document.querySelector(maxSel);
          if (!defaultEl || !maxEl) return;
          defaultEl.style.display = isMaxOn ? 'none' : 'block';
          maxEl.style.display     = isMaxOn ? 'block' : 'none';
        });
      }

      // Public: set wording for max-toggle across all charts
      window.setMaxToggle = function(isMaxOn){
        toggleTextFor([
          { defaultSel: '#chart-pension-value .pv-default', maxSel: '#chart-pension-value .pv-max' },
          { defaultSel: '#chart-annual-contrib .ac-default', maxSel: '#chart-annual-contrib .ac-max' },
          { defaultSel: '#chart-retirement-balance .rb-default', maxSel: '#chart-retirement-balance .rb-max' },
        ], isMaxOn);
      };

      // Public: insert depletion messages for Retirement Balance (conditional, data-driven)
      window.updateRetirementBalanceConditions = function({ depletionAgeCurrent = null, depletionAgeMax = null } = {}){
        const slot = document.querySelector('#chart-retirement-balance .conditional-slot');
        if (!slot) return;
        slot.innerHTML = '';

        if (typeof depletionAgeCurrent === 'number') {
          const p = document.createElement('p');
          p.className = 'tooltip-text';
          p.innerHTML = `Your pension could deplete around age <strong>${depletionAgeCurrent}</strong>. This risk could be improved by maximising contributions.`;
          slot.appendChild(p);
        }

        if (typeof depletionAgeMax === 'number') {
          const p = document.createElement('p');
          p.className = 'tooltip-text';
          p.innerHTML = `Even maximising contributions may not be enough to meet your Financial Freedom Target (depletion around age <strong>${depletionAgeMax}</strong>). A coordinated pension and personal investment strategy may be required — professional advice is strongly recommended.`;
          slot.appendChild(p);
        }
      };

    })();
  </script>

  <!-- listener that handles fm-run-pension and emits fm-pension-output -->
  <script type="module" src="./pensionProjection.js"></script>

  <script type="module" src="./fullMontyResults.js"></script>
  <script type="module" src="./fullMontyWizard.js"></script>
</body>
</html>
